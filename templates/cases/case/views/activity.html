{% load static %}

<h3 class="govuk-heading-m">Activity</h3>

<form method="post" onSubmit="return confirmVisible()">
	{% csrf_token %}
	<div class="lite-expandable-textarea lite-case-note-no-transition">
		<textarea id="case_note" name="text" cols="80" class="govuk-textarea" placeholder="Add case note"></textarea>
		<div class="lite-expandable-textarea-controls">
            <div class="govuk-checkboxes govuk-checkboxes--small">
						<div class="govuk-checkboxes__item">
							<input class="govuk-checkboxes__input" type="checkbox" id="is_visible_to_exporter" name="is_visible_to_exporter" value="True">
							<label class="govuk-label govuk-checkboxes__label" for="is_visible_to_exporter">Make visible to exporter</label>
						</div>
					</div>
			<a id="case-note-cancel-button" href="{% url 'cases:case' case.id %}" class="govuk-button govuk-button--secondary govuk-button--secondary-white" type="button" draggable="false">
				Cancel
			</a>
			<button class="govuk-button" type="submit" id="button-post-note">
				Post note
			</button>
		</div>
	</div>
	<p id="case_note-warning" class="govuk-hint govuk-character-count__message" aria-live="polite">
		{% get_string 'cases.case.tabs.activity.2200_character_limit' %}
	</p>
</form>

<div class="app-activity__list">
	{% for item in activity %}
		<div id="case-activity-{{ item.id }}" class="app-activity__item">
			<p class="govuk-body">
				<span class="user">{{ item.user.first_name }} {{ item.user.last_name }}</span> {{ item.text }}
			</p>
			{% if item.additional_text %}
				<div class="app-activity__additional-text">
					{{ item.additional_text }}
				</div>
			{% endif %}
			<p class="govuk-hint govuk-!-font-size-16">{{ item.created_at|str_date }}</p>
		</div>
	{% endfor %}
</div>

<script src="{% static 'javascripts/pluralize.js' %}"></script>
<script src="{% static 'javascripts/case_notes.js' %}"></script>
<script nonce="{{ request.csp_nonce }}">
    function confirmVisible() {
        let is_visible_for_exporter = document.getElementById('is_visible_to_exporter')
        if (is_visible_for_exporter.checked) {
            return confirm("This message will be visible to the exporter, are you sure you wish to continue?")
        }
        return true;
    }
</script>
