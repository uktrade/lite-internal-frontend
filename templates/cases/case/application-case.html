{% extends 'layouts/base.html' %}

{% load humanize static %}

{% block back_link %}
	<a href="{% url 'cases:cases' %}" class="govuk-back-link">{% get_string 'cases.case.back_to_cases_link' %}</a>
{% endblock %}

{% load svg %}

{% block body %}

<div class="lite-app-bar">
	<div class="lite-app-bar__content">
		<h1 class="govuk-heading-l">{{ title }}</h1>
	</div>
	<div class="lite-app-bar__controls">
		<div class="app-more-actions__container">
			<a role="button" draggable="false" class="govuk-button" href="{% url 'cases:documents' case.id %}">
	        	{% get_string 'cases.manage.documents.button' %}
	        </a>
	        <a role="button" draggable="false" class="govuk-button" href="{% url 'cases:ecju_queries' case.id %}">
	            {% get_string 'cases.ecju_queries.title' %}
			</a>
	        <a role="button" draggable="false" class="govuk-button" href="{% url 'cases:move' case.id %}">
				{% get_string 'cases.manage.move_case.button' %}
			</a>
			<a role="button" draggable="false" class="govuk-button" href="{% url 'cases:manage' case.id %}">
				Change Status
			</a>
			{% if permissions|key_in_array:'MAKE_FINAL_DECISIONS' %}
				<a role="button" draggable="false" class="govuk-button" href="{% url 'cases:decide' case.id %}">
					Record Decision
				</a>
			{% endif %}
	        <a role="button" draggable="false" class="govuk-button" href="{% url 'cases:advice_view' case.id %}">
				View Advice
			</a>
		</div>
	</div>
</div>

<!-- Case flags -->
{% include 'cases/case/views/case-flags.html' %}

<!-- Information board -->
{% include 'cases/case/views/application-information-board.html' %}

{% if case.application.application_denial_reason %}
<h3 class="govuk-heading-m">Denial Reasons</h3>
{% for reason in case.application.application_denial_reason %}
<p class="govuk-heading-s">This case was denied because</p>
{% for reason_id in reason.reasons %}
<p class="govuk-label">{{ reason_id.id }}</p>
{% endfor %}
{% if reason.reason_details %}
<br />
<p class="govuk-heading-s">Further information</p>
<p class="govuk-label">{{ reason.reason_details }}</p>
{% endif %}
{% endfor %}
<br /><br />
{% endif %}

<!-- <div class="lite-tabs--fade">
	<div class="lite-tabs">
		<a class="lite-tabs__tab">Goods</a>
		<a class="lite-tabs__tab">Destinations</a>
		<a class="lite-tabs__tab selected" id="activity">Activity</a>
	</div>
</div> -->

<h3 class="govuk-heading-m">{% get_string 'cases.case.goods_heading' %}</h3>
<table class="lite-table">
	<thead class="lite-table__head">
		<tr class="lite-table__row">
		  <th class="lite-table__header" scope="col">Description</th>
		  <th class="lite-table__header" scope="col">Controlled?</th>
		  <th class="lite-table__header" scope="col">Control Code</th>
		  <th class="lite-table__header" scope="col">End Product?</th>
		  <th class="lite-table__header" scope="col">Part Number</th>
          <th class="lite-table__header" scope="col">Documents</th>
		</tr>
	</thead>
	<tbody class="lite-table__body">
		{% for good in data.case.application.goods %}
			<tr class="lite-table__row">
			  <td class="lite-table__cell">{{ good.good.description }}</td>
			  <td class="lite-table__cell">{{ good.good.is_good_controlled }}</td>
			  <td class="lite-table__cell">{{ good.good.control_code|default:'None' }}</td>
			  <td class="lite-table__cell">{{ good.good.is_good_end_product }}</td>
			  <td class="lite-table__cell">{{ good.good.part_number|default:'None' }}</td>
              <td class="lite-table__cell">
                {% for document in good.good.documents %}
                    {% if document.safe == True %}
                        <a class="govuk-link lite-link--icon govuk-link--no-visited-state" href="{% url 'cases:document' data.case.id document.id %}">
                            <span class="govuk-visually-hidden">{% get_string 'cases.manage.documents.download_document' %}</span>
                            {{ document.name }}<br>
                        </a>
                    {% endif %}
                 {% endfor %}
               </td>
		{% endfor %}
	</tbody>
</table>

<br><br><br><br>

<h3 class="govuk-heading-m">{% get_string 'cases.case.destination_heading' %}</h3>
{% if data.case.application.destinations.type == 'end_user' %}
    <table class="lite-table" id="destinations">
	<thead class="lite-table__head">
		<tr class="lite-table__row">
		  <th class="lite-table__header" scope="col">Name</th>
          <th class="lite-table__header" scope="col">Destination Type</th>
		  <th class="lite-table__header" scope="col">Type</th>
          <th class="lite-table__header" scope="col">Website</th>
		  <th class="lite-table__header" scope="col">Address</th>
		  <th class="lite-table__header" scope="col">Country</th>
		  <th class="lite-table__header" scope="col">Document</th>
		</tr>
	</thead>
	<tbody class="lite-table__body">
        <tr class="lite-table__row">
          <td class="lite-table__cell">{{ data.case.application.destinations.data.name }}</td>
          <td class="lite-table__cell">End User</td>
          <td class="lite-table__cell">{{ data.case.application.destinations.data.type }}</td>
          <td class="lite-table__cell">{{ data.case.application.destinations.data.website|default:'None' }}</td>
          <td class="lite-table__cell">{{ data.case.application.destinations.data.address }}</td>
          <td class="lite-table__cell">{{ data.case.application.destinations.data.country }}</td>
          <td class="lite-table__cell">
            {% if data.case.application.destinations.data.document.safe == True %}
                <a class="govuk-link lite-link--icon govuk-link--no-visited-state" href="{% url 'cases:document' data.case.id data.case.application.destinations.data.document.id %}">
                    <span class="govuk-visually-hidden">{% get_string 'cases.manage.documents.download_document' %}</span>
                    {{ data.case.application.destinations.data.document.name }}<br>
                </a>
            {% endif %}
          </td>
        </tr>
        {% for ultimate_end_user in data.case.application.ultimate_end_users.data %}
            <tr>
              <td class="lite-table__cell">{{ ultimate_end_user.name }}</td>
              <td class="lite-table__cell">Ultimate End User</td>
              <td class="lite-table__cell">{{ ultimate_end_user.type }}</td>
              <td class="lite-table__cell">{{ ultimate_end_user.website|default:'None' }}</td>
              <td class="lite-table__cell">{{ ultimate_end_user.address }}</td>
              <td class="lite-table__cell">{{ ultimate_end_user.country }}</td>
            </tr>
        {% endfor %}
	</tbody>
</table>
{% else %}
	{% for country in data.case.application.destinations.data %}
		<p class="govuk-label">
			{{ country.name }}
		</p>
	{% endfor %}
{%  endif %}

<!-- Goods -->
{% if case.application.licence_type.key == 'open_licence' %}
	{% include 'cases/case/views/open-goods.html' %}
{% endif %}
{% if case.application.licence_type.key == 'standard_licence' %}
	{% include 'cases/case/views/standard-goods.html' %}
{% endif %}

<!-- Destinations/End-User -->
{% if case.application.licence_type.key == 'open_licence' %}
	{% include 'cases/case/views/open-destinations.html' %}
{% endif %}
{% if case.application.licence_type.key == 'standard_licence' %}
	{% include 'cases/case/views/standard-destinations.html' %}
{% endif %}

{% include "cases/case/tabs/activity.html" %}

{% endblock %}

{% block javascript %}
	<!-- <script src="{% static 'javascripts/more-actions.js' %}"></script> -->
{% endblock %}
