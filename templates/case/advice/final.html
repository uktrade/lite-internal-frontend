{% extends 'layouts/base.html' %}

{% load static %}

{% block back_link %}
	{% include "case/views/includes/breadcrumbs.html" with text="cases.ApplicationPage.Actions.ADVICE" %}
{% endblock %}

{% block body %}
	{% include 'includes/messages.html' %}

	<h1 class="govuk-heading-xl">
		{% lcs 'cases.ApplicationPage.Actions.ADVICE' %}
	</h1>

	<form method="post">

		{% csrf_token %}

		<!-- Tab bar -->
		<div style="display: grid; grid-template-columns: 1fr auto; grid-gap: 30px;">
			<div class="lite-tabs--fade">
				<div class="lite-tabs">
					<a href="{% url 'cases:user_advice_view' case.id %}" class="lite-tabs__tab" id="user_advice">User Advice</a>
                    <a href="{% url 'cases:team_advice_view' case.id %}" class="lite-tabs__tab" id="team_advice">Team Advice</a>
                    <a href="{% url 'cases:final_advice_view' case.id %}" class="lite-tabs__tab lite-tabs__tab--selected" id="final_advice">Final Advice</a>
				</div>
			</div>
            {% if not status_is_terminal %}
                {% if 'MANAGE_FINAL_ADVICE' in permissions %}
                    {% if case.has_advice.team %}
                        {% if all_advice|length %}
                            <div>
                                <button id="button-give-advice" name="action" value="give-advice" type="submit" class="govuk-button" data-module="govuk-button">
                                    Give or change advice
                                </button>
                                <button id="button-clear-advice" name="action" value="delete" type="submit" class="govuk-button" data-module="govuk-button">
                                    Clear advice
                                </button>
                                {% if able_to_finalize %}
                                    {% if case.application.application_type.key == 'open_licence' %}
                                        <a class="govuk-button"  href="{% url 'cases:finalise_goods_countries' case.id %}" id="finalise_button">
                                            Finalise goods and countries
                                        </a>
                                    {% else %}
                                        <a class="govuk-button"  href="{% url 'cases:finalise' case.id %}" id="finalise_button">
                                            Finalise
                                        </a>
                                    {% endif %}
                                {% endif %}
                            </div>
                        {% else %}
                            <a class="govuk-button" href="{% url 'cases:coalesce_team_advice' case.id %}" class="lite-tabs__tab" id="combine_advice_button">
                                Combine all team advice
                            </a>
                        {% endif %}
                    {% endif %}
                {% endif %}
            {% endif %}
		</div>

		<!-- Conditional error wrapper -->
        {% if not case.has_advice.team %}
            {% include 'case/views/advice-view.html' with show_advice=True %}
        {% elif case.application.status == 'finalised' %}
            {% include 'case/views/advice-view.html' with show_advice=True %}
        {% elif all_advice|length and 'MANAGE_FINAL_ADVICE' in permissions %}
            {% include 'case/views/advice-view.html' with show_checkboxes=True show_advice=True %}
        {% else %}
            {% include 'case/views/advice-view.html' with show_advice=True %}
        {% endif %}

	</form>

{% endblock %}

{% block javascript %}
	<script src="{% static 'javascripts/advice-view.js' %}"></script>
{% endblock %}
