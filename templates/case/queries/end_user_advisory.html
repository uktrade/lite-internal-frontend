{% extends 'layouts/base.html' %}

{% load static %}

{% block back_link %}
	<div class="govuk-breadcrumbs">
		<ol class="govuk-breadcrumbs__list">
			<li class="govuk-breadcrumbs__list-item">
				<a class="govuk-breadcrumbs__link" href="{% url 'cases:cases' %}?queue={{ queue.queue.id }}">{% if queue_name %}{{ queue_name }}{% else %}{% lcs 'QUEUE_ALL_CASES' %}{% endif %}</a>
			</li>
			<li class="govuk-breadcrumbs__list-item" aria-current="page">&nbsp;</li>
		</ol>
	</div>
{% endblock %}

{% block body %}
    {% if case.audit_notification %}
        <a id="audit-notification" class="lite-info-bar lite-info-bar--link lite-info-bar--no-animation" href="#case-activity-{{ case.audit_notification.audit_id }}">
            {% lcs 'CASE_CHANGES' %}
        </a>
    {% endif %}

	<div class="lite-app-bar">
		<div class="lite-app-bar__content">
			<p class="govuk-caption-m">{{ case.type.value }} by <a class="govuk-link govuk-link--no-visited-state" style="display: inline-block;" href="{% url 'organisations:organisation' case.query.organisation.id %}">{{ case.case_officer.first_name }} {{ case.case_officer.last_name }}</a></p>
			<h2 class="govuk-heading-l">{{ case.query.id|reference_code }}</h2>
		</div>
		<div class="lite-app-bar__controls">
			<div class="app-more-actions__container" id="actions-list">
				<a name="action-button" role="button" draggable="false" class="govuk-button" href="{% url 'cases:documents' case.id %}">
					{% lcs 'Cases.EndUserAdvisoriesPage.Actions.DOCUMENT' %}
				</a>
				<a name="action-button" role="button" draggable="false" class="govuk-button" href="{% url 'cases:ecju_queries' case.id %}">
					{% lcs 'Cases.EndUserAdvisoriesPage.Actions.ECJU' %}
				</a>
				<a name="action-button" role="button" draggable="false" class="govuk-button" href="{% url 'cases:move' case.id %}">
					{% lcs 'Cases.EndUserAdvisoriesPage.Actions.MOVE' %}
				</a>
                {% if permissible_statuses %}
                    {% if not status_is_terminal or 'REOPEN_CLOSED_CASES' in permissions %}
                    <a name= "action-button" role="button" draggable="false" class="govuk-button" id="change-status" href="{% url 'cases:manage' case.id %}">
                        {% lcs 'CASES.EndUserAdvisoriesPage.Actions.CHANGE_STATUS' %}
                    </a>
                    {% endif %}
                {% endif %}
				<a name="action-button" role="button" draggable="false" class="govuk-button" id="case-officer" href="{% url 'cases:case_officer' case.id %}">
					{% lcs 'Cases.EndUserAdvisoriesPage.Actions.CASE_OFFICER' %}
				</a>
				<a name="action-button" role="button" draggable="false" class="govuk-button" id="generate-document" href="{% url 'cases:generate_document' case.id %}">
					{% lcs 'Cases.EndUserAdvisoriesPage.Actions.GENERATE_DOCUMENT' %}
				</a>
			</div>
		</div>
	</div>

    {% if case.case_officer %}
        <p class="govuk-caption-m">{% lcs 'Cases.EndUserAdvisoriesPage.CASE_OFFICER' %} <a class="govuk-link govuk-link--no-visited-state" href="{% url 'users:user' case.case_officer.id %}">{{ case.case_officer|username }}</a></p>
    {% else %}
        <p class="govuk-caption-m">{% lcs 'Cases.EndUserAdvisoriesPage.NO_CASE_OFFICER' %}</p>
    {% endif %}

    <!-- Case flags -->
	{% include 'case/views/case-flags.html' %}

	<br><br>

	<h3 class="govuk-heading-m">{% lcs 'Cases.EndUserAdvisoriesPage.Details.TITLE' %}</h3>
	<div class="govuk-!-width-two-thirds">
		<dl class="govuk-summary-list">
			<div class="govuk-summary-list__row">
				<dt class="govuk-summary-list__key">
					{% lcs 'Cases.EndUserAdvisoriesPage.Details.NAME' %}
				</dt>
				<dd class="govuk-summary-list__value">
					{{ case.query.end_user.name }}
				</dd>
			</div>
			<div class="govuk-summary-list__row">
				<dt class="govuk-summary-list__key">
					{% lcs 'Cases.EndUserAdvisoriesPage.Details.TYPE' %}
				</dt>
				<dd class="govuk-summary-list__value">
					{{ case.query.end_user.sub_type.value }}
				</dd>
			</div>
            {% if case.query.end_user.sub_type.key == 'individual' %}
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        {% lcs 'Cases.EndUserAdvisoriesPage.Details.EMAIL' %}
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {{ case.query.contact_email }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        {% lcs 'Cases.EndUserAdvisoriesPage.Details.TELEPHONE' %}
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {{ case.query.contact_telephone }}
                    </dd>
                </div>
            {% endif %}
            {% if case.query.end_user.sub_type.key == 'commercial' %}
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        {% lcs 'Cases.EndUserAdvisoriesPage.Details.NATURE_OF_BUSINESS' %}
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {{ case.query.nature_of_business }}
                    </dd>
                </div>
            {% endif %}
            {% if case.query.end_user.sub_type.key != 'individual' %}
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        {% lcs 'Cases.EndUserAdvisoriesPage.Details.PRIMARY_CONTACT_NAME' %}
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {{ case.query.contact_name }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        {% lcs 'Cases.EndUserAdvisoriesPage.Details.PRIMARY_CONTACT_JOB' %}
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {{ case.query.contact_job_title }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        {% lcs 'Cases.EndUserAdvisoriesPage.Details.PRIMARY_CONTACT_EMAIL' %}
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {{ case.query.contact_email }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        {% lcs 'Cases.EndUserAdvisoriesPage.Details.PRIMARY_CONTACT_TELEPHONE' %}
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {{ case.query.contact_telephone }}
                    </dd>
                </div>
            {% endif %}
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                    {% lcs 'Cases.EndUserAdvisoriesPage.Details.ADDRESS' %}
                </dt>
                <dd class="govuk-summary-list__value">
                    {{ case.query.end_user.address }}<br>{{ case.query.end_user.country.name }}
                </dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                    {% lcs 'Cases.EndUserAdvisoriesPage.Details.WEBSITE' %}
                </dt>
                <dd class="govuk-summary-list__value">
                    {% if case.query.end_user.website %}
                        <a class="govuk-link" href="{{ case.query.end_user.website }}">{{ case.query.end_user.website }}</a>
                    {% else %}
                        N/A
                    {% endif %}
                </dd>
            </div>
			<div class="govuk-summary-list__row">
				<dt class="govuk-summary-list__key">
                    {% lcs 'Cases.EndUserAdvisoriesPage.Details.REASONING' %}
				</dt>
				<dd class="govuk-summary-list__value">
					{{ case.query.reasoning|default_na }}
				</dd>
			</div>
			<div class="govuk-summary-list__row">
				<dt class="govuk-summary-list__key">
                    {% lcs 'Cases.EndUserAdvisoriesPage.Details.NOTES' %}
				</dt>
				<dd class="govuk-summary-list__value">
					{{ case.query.note|default_na }}
				</dd>
			</div>
            {% if case.query.copy_of %}
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        {% lcs 'Cases.EndUserAdvisoriesPage.Details.COPY_FROM' %}
                    </dt>
                    <dd class="govuk-summary-list__value">
                        <a class="govuk-link" href="{% url 'cases:case' case.query.copy_of %}">{{ case.query.copy_of|reference_code }}</a>
                    </dd>
                </div>
            {% endif %}
		</dl>


        <div class="app-flags" id="application-destination-flags">
            {% for flag in case.query.end_user.flags %}
                <div class="app-flag" id="{{ flag.name }}">
                    {{ flag.name }}
                </div>
            {% endfor %}
            <a class="app-flag app-flag--action" href="{% url 'cases:assign_flags' case.id %}?level=destinations&items={{ case.query.end_user.id }}&origin=case">
                {% lcs 'Cases.EndUserAdvisoriesPage.EDIT_DESTINATION_FLAGS' %}
            </a>
        </div>

		<br><br>

		{% include "case/views/activity.html" %}

	</div>

{% endblock %}

{% block javascript %}
	<script src="{% static 'javascripts/more-actions.js' %}"></script>
{% endblock %}
