{% extends 'layouts/case.html' %}

{% load static %}

{% block additional_controls %}
	{% if not verified and 'REVIEW_GOODS' in permissions and not status_is_terminal %}
		<a role="button" draggable="false" id="button-respond" class="govuk-button" href="{% url 'cases:respond_to_clc_query' case.id %}">
			{% lcs 'cases.ApplicationPage.RESPOND_BUTTON' %}
		</a>
	{% endif %}
{% endblock %}

{% block details %}
    {% if verified %}
		<div class="lite-info-bar lite-info-bar--no-animation {% if message.tags %}lite-info-bar--{{ message.tags }}{% endif %}">
			{% lcs 'cases.ApplicationPage.CLOSED' %}
		</div>
	{% endif %}

    {% if case.audit_notification %}
        <a id="audit-notification" class="lite-info-bar lite-info-bar--link lite-info-bar--no-animation" href="#case-activity-{{ case.audit_notification.audit_id }}">
            {% lcs 'CASE_CHANGES' %}
        </a>
    {% endif %}

	{% if verified %}
		<div class="govuk-!-width-two-thirds">
			<div class="app-panel app-panel--info">
				<h3 class="govuk-heading-m">{% lcs 'cases.ClcQuery.Verified.OUTCOME' %}</h3>

				<hr>

				<h4 class="govuk-heading-s">{% lcs 'cases.ClcQuery.Verified.CONTROLLED' %}</h4>
				<p class="govuk-body-m">{{ good.is_good_controlled.value }}</p>

				<h4 class="govuk-heading-s">{% lcs 'cases.ClcQuery.Verified.CONTROL_CODE' %}</h4>
				<p class="govuk-body-m">{{ good.control_code|default_na }}</p>

				<h4 class="govuk-heading-s">{% lcs 'cases.ClcQuery.Verified.REPORT' %}</h4>
				<p class="govuk-body-m">{{ case.query.good.report_summary|default_na }}</p>

				<h4 class="govuk-heading-s">{% lcs 'cases.ClcQuery.Verified.COMMENT' %}</h4>
				<p class="govuk-body-m">{{ case.query.good.comment|default_na }}</p>
			</div>
		</div>

		<br><br>
	{% endif %}

	<h3 class="govuk-heading-m">{% lcs 'cases.ClcQuery.GoodDetails.TITLE' %}</h3>
	<div class="govuk-!-width-two-thirds">
		<dl class="govuk-summary-list">
			<div class="govuk-summary-list__row">
				<dt class="govuk-summary-list__key">
                    {% lcs 'cases.ClcQuery.GoodDetails.DESCRIPTION' %}
				</dt>
				<dd class="govuk-summary-list__value">
					{{ good.description }}
				</dd>
			</div>
			<div class="govuk-summary-list__row">
				<dt class="govuk-summary-list__key">
                    {% lcs 'cases.ClcQuery.GoodDetails.CONTROLLED' %}
				</dt>
				<dd class="govuk-summary-list__value">
					{{ good.is_good_controlled.value }}
				</dd>
			</div>
			<div class="govuk-summary-list__row">
			{% if good.is_good_controlled != 'Unsure' %}
				<dt class="govuk-summary-list__key">
                    {% lcs 'cases.ClcQuery.GoodDetails.CONTROL_CODE' %}
				</dt>
            {% else %}
                <dt class="govuk-summary-list__key">
                    {% lcs 'cases.ClcQuery.GoodDetails.EXPECTED_CONTROL_CODE' %}
				</dt>
			{% endif %}
				<dd class="govuk-summary-list__value">
					{{ good.control_code|default:"N/A" }}
				</dd>
			</div>
            <div class="govuk-summary-list__row">
				<dt class="govuk-summary-list__key">
                    {% lcs 'cases.ClcQuery.GoodDetails.REASON' %}
				</dt>
				<dd class="govuk-summary-list__value">
					{{ case.query.details|default_na }}
				</dd>
			</div>
			<div class="govuk-summary-list__row">
				<dt class="govuk-summary-list__key">
                    {% lcs 'cases.ClcQuery.GoodDetails.PART_NUMBER' %}
				</dt>
				<dd class="govuk-summary-list__value">
					{{ good.part_number|default_na }}
				</dd>
			</div>
			<div class="govuk-summary-list__row">
				<dt class="govuk-summary-list__key">
                    {% lcs 'cases.ClcQuery.GoodDetails.FLAGS' %}
				</dt>
				<dd class="govuk-summary-list__value">
					{% include 'case/views/goods-flags.html' with origin='case' %}
				</dd>
			</div>
		</dl>

		<!-- Query Details -->
		{% if data.case.query.details %}
			<div class="govuk-grid-row">
				<div class="govuk-grid-column-full">
					<p class="lite-heading-s">{% lcs 'cases.ClcQuery.GoodDetails.QUERY_TEXT' %}</p>
					<p class="govuk-label">
						{{ data.case.query.details }}
					</p>
				</div>
			</div>
		{% endif %}

		<br><br>

		<h3 class="govuk-heading-m">{% lcs 'cases.ClcQuery.Documents.TITLE' %}</h3>
		{% if case.query.good.documents %}
			<dl class="govuk-summary-list">
				{% for document in case.query.good.documents %}
					<div class="govuk-summary-list__row">
						<dt class="govuk-summary-list__key">
							{{ document.name }}
						</dt>
						<dd class="govuk-summary-list__value">
							{% if document.safe == True %}
								<a class="govuk-link lite-link--icon govuk-link--no-visited-state" href="{% url 'cases:document' case.id document.id %}">
									{% lcs 'cases.ClcQuery.Documents.DOWNLOAD' %}
								</a>
							{% elif document.safe == False %}
								{% lcs 'cases.Manage.Documents.VIRUS_INFECTED' %}
							{% else %}
								{% lcs 'cases.Manage.Documents.PROCESSING' %}
							{% endif %}
						</dd>
					</div>
				{% endfor %}
			</dl>
		{% else %}
			{% include "includes/information-text.html" with text='This good has no documents attached' %}
			<br><br>
		{% endif %}

		<br><br>

		{% include "case/views/activity.html" %}
	</div>
{% endblock %}
