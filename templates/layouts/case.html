{% extends 'layouts/base.html' %}

{% load svg static %}

{% block back_link %}
	<div class="govuk-breadcrumbs">
		<ol class="govuk-breadcrumbs__list">
			<li class="govuk-breadcrumbs__list-item">
				<a class="govuk-breadcrumbs__link" href="{% url 'cases:cases' %}?queue={{ queue.queue.id }}">{% if queue_name %}{{ queue_name }}{% else %}{% lcs 'QUEUE_ALL_CASES' %}{% endif %}</a>
			</li>
			<li class="govuk-breadcrumbs__list-item" aria-current="page">
				{{ case.reference_code }}
			</li>
		</ol>
	</div>
{% endblock %}

{% block body_classes %}lite-main-wrapper--case{% endblock %}

{% block body %}
	{% if case.audit_notification %}
		<a id="audit-notification" class="lite-info-bar lite-info-bar--link lite-info-bar--no-animation" href="#case-activity-{{ case.audit_notification.audit_id }}">
			{% lcs 'CASE_CHANGES' %}
		</a>
	{% endif %}

	<div class="lite-app-bar">
		<div class="lite-app-bar__content">
			<h1 class="govuk-heading-l">
				{% block title %}
					{{ case.reference_code }}
				{% endblock %}
			</h1>
		</div>
		<div class="lite-app-bar__controls">
			<div class="lite-more-actions__container">
				<a role="button" draggable="false" class="govuk-button" href="{% url 'cases:documents' case.id %}">
		        	{% lcs 'Cases.ApplicationPage.Actions.DOCUMENT' %}
					{% svg 'case-actions/attached' %}
		        </a>
		        <a role="button" draggable="false" class="govuk-button" href="{% url 'cases:ecju_queries' case.id %}">
		            {% lcs 'Cases.ApplicationPage.Actions.ECJU' %}
					{% svg 'case-actions/query' %}
				</a>
		        <a role="button" draggable="false" class="govuk-button" href="{% url 'cases:move' case.id %}">
					{% lcs 'Cases.ApplicationPage.Actions.MOVE' %}
					{% svg 'case-actions/move' %}
				</a>
                {% if not status_is_terminal or 'REOPEN_CLOSED_Cases' in permissions %}
					<a role="button" draggable="false" class="govuk-button" id="change-status" href="{% url 'cases:manage' case.id %}">
						{% lcs 'Cases.ApplicationPage.Actions.CHANGE_STATUS' %}
						{% svg 'case-actions/status' %}
					</a>
                {% endif %}
				{% if permissions|key_in_array:'MAKE_FINAL_DECISIONS' %}
					<a role="button" draggable="false" class="govuk-button" href="{% url 'cases:decide' case.id %}">
						{% lcs 'Cases.ApplicationPage.Actions.DECISION' %}
						{% svg 'case-actions/post' %}
					</a>
				{% endif %}
		        <a role="button" draggable="false" class="govuk-button" href="{% url 'cases:user_advice_view' case.id %}">
					{% lcs 'Cases.ApplicationPage.Actions.ADVICE' %}
					{% svg 'case-actions/advice' %}
				</a>
                <a role="button" draggable="false" class="govuk-button" id="generate-document" href="{% url 'cases:generate_document' case.id %}">
					{% lcs 'Cases.ApplicationPage.Actions.GENERATE_DOCUMENT' %}
					{% svg 'case-actions/document' %}
				</a>
                <a role="button" draggable="false" class="govuk-button" id="case-officer" href="{% url 'cases:case_officer' case.id %}">
                    {% lcs 'Cases.ApplicationPage.Actions.CASE_OFFICER' %}
					{% svg 'case-actions/officer' %}
                </a>
			</div>
		</div>
	</div>

    {% if case.case_officer %}
        <p class="govuk-caption-m">{% lcs 'Cases.ApplicationPage.CASE_OFFICER' %} <a class="govuk-link govuk-link--no-visited-state" href="{% url 'users:user' case.case_officer.id %}">{{ case.case_officer|username }}</a></p>
    {% else %}
        <p class="govuk-caption-m">{% lcs 'Cases.ApplicationPage.NO_CASE_OFFICER' %}</p>
    {% endif %}

	<div class="app-flags" id="application-case-flags">
		{% for flag in case.flags %}
			<div class="app-flag" id="{{ flag.name }}">
				{{ flag.name }}
			</div>
		{% endfor %}
		<a href="{% url 'cases:assign_flags' case.id %}?level=cases&items={{ case.id }}" id="application-edit-case-flags" class="app-flag app-flag--action">
			{% if case.flags %}
				{% lcs 'EDIT_CASE_FLAGS' %}
			{% else %}
				{% lcs 'SET_CASE_FLAGS' %}
			{% endif %}
		</a>
	</div>

	<div class="app-flags" id="application-all-flags">
		{% for flag in case.all_flags %}
			<div class="app-flag" id="{{ flag.name }}">
				{{ flag.name }}
			</div>
		{% endfor %}
	</div>

	{% block deetails %}{% endblock %}
{% endblock %}

{% block javascript %}
	<script src="{% static 'javascripts/select-buttons.js' %}"></script>
	<script src="{% static 'more-actions.js' %}"></script>
{% endblock %}
