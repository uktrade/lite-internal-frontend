{% extends 'layouts/base.html' %}

{% load svg static %}

{% block back_link %}
	{% include "case/views/includes/breadcrumbs.html" %}
{% endblock %}

{% block body_classes %}lite-main-wrapper--case{% endblock %}

{% block body %}
	{% if case.audit_notification %}
		<a id="audit-notification" class="lite-info-bar lite-info-bar--link lite-info-bar--no-animation" href="#case-activity-{{ case.audit_notification.audit_id }}">
			{% lcs 'CASE_CHANGES' %}
		</a>
	{% endif %}

	<div class="lite-app-bar">
		<div class="lite-app-bar__content">
			<h1 class="govuk-heading-l govuk-!-margin-0">
				{% block title %}
					{{ case.reference_code }}
				{% endblock %}
			</h1>
		</div>
		<div class="lite-app-bar__controls">
			<div class="govuk-!-margin-right-3">
				{% block additional_controls %}
				{% endblock %}
			</div>
			<div id="actions-list" class="lite-more-actions__container">
				<a role="button" draggable="false" class="govuk-button" href="{% url 'cases:documents' case.id %}">
					{% lcs 'cases.ApplicationPage.Actions.DOCUMENT' %}
				</a>
				<a role="button" draggable="false" class="govuk-button" href="{% url 'cases:ecju_queries' case.id %}">
					{% lcs 'cases.ApplicationPage.Actions.ECJU' %}
				</a>
				<a role="button" draggable="false" class="govuk-button" href="{% url 'cases:move' case.id %}">
					{% lcs 'cases.ApplicationPage.Actions.MOVE' %}
				</a>
				{% if permissible_statuses %}
					{% if not status_is_terminal or 'REOPEN_CLOSED_CASES' in permissions %}
						<a role="button" draggable="false" class="govuk-button" id="change-status" href="{% url 'cases:manage' case.id %}">
							{% lcs 'cases.ApplicationPage.Actions.CHANGE_STATUS' %}
						</a>
					{% endif %}
				{% endif %}
				{% if permissions|key_in_array:'MAKE_FINAL_DECISIONS' %}
					<a role="button" draggable="false" class="govuk-button" href="{% url 'cases:decide' case.id %}">
						{% lcs 'cases.ApplicationPage.Actions.DECISION' %}
					</a>
				{% endif %}
				{% if case.type.key != "clc_query" and case.type.key != "end_user_advisory_query" %}
					<a role="button" draggable="false" class="govuk-button" href="{% url 'cases:user_advice_view' case.id %}">
						{% lcs 'cases.ApplicationPage.Actions.ADVICE' %}
					</a>
				{% endif %}
				<a role="button" draggable="false" class="govuk-button" id="generate-document" href="{% url 'cases:generate_document' case.id %}">
					{% lcs 'cases.ApplicationPage.Actions.GENERATE_DOCUMENT' %}
				</a>
				<a role="button" draggable="false" class="govuk-button" id="case-officer" href="{% url 'cases:case_officer' case.id %}">
					{% lcs 'cases.ApplicationPage.Actions.CASE_OFFICER' %}
				</a>
			</div>
		</div>
	</div>

	{% if case.case_officer %}
		<p class="govuk-caption-m">{% lcs 'cases.ApplicationPage.CASE_OFFICER' %} <a class="govuk-link govuk-link--no-visited-state" href="{% url 'users:user' case.case_officer.id %}">{{ case.case_officer|username }}</a></p>
	{% else %}
		<p class="govuk-caption-m">{% lcs 'cases.ApplicationPage.NO_CASE_OFFICER' %}</p>
	{% endif %}

	<div class="govuk-!-margin-bottom-6" id="case_queues">
		{% for queue_name in case.queue_names %}
			<div class="govuk-caption-m">{{ queue_name }}</div>
		{% empty %}
			<span class="govuk-caption-m">{% lcs 'cases.ApplicationPage.NO_QUEUES_ASSIGNED' %}</span>
		{% endfor %}
	</div>

	<div class="govuk-!-margin-bottom-6" id="assigned_users">
		{% for user in case.users %}
			<div class="govuk-caption-m">
				<span>{{ user.queue }}:</span>
					{% if user.first_name %}
						{{ user.first_name }} {{ user.last_name }}
					{% else %}
						{{ user.email }}
					{% endif %}
			</div>
		{% empty %}
			<span class="govuk-caption-m">{% lcs 'cases.ApplicationPage.NO_USERS_ASSIGNED' %}</span>
		{% endfor %}
	</div>

	<div class="app-flags" id="application-case-flags">
		{% for flag in case.flags %}
			<div class="app-flag" id="{{ flag.name }}">
				{{ flag.name }}
			</div>
		{% endfor %}
		<a href="{% url 'cases:assign_flags' case.id %}?level=cases&items={{ case.id }}" id="application-edit-case-flags" class="app-flag app-flag--action">
			{% if case.flags %}
				{% lcs 'EDIT_CASE_FLAGS' %}
			{% else %}
				{% lcs 'SET_CASE_FLAGS' %}
			{% endif %}
		</a>
	</div>

	<div class="app-flags" id="application-all-flags">
		{% for flag in case.all_flags %}
			<div class="app-flag" id="{{ flag.name }}">
				{{ flag.name }}
			</div>
		{% endfor %}
	</div>

	{% block details %}{% endblock %}
{% endblock %}

{% block javascript %}
	<script src="{% static "javascripts/select-buttons.js" %}"></script>
	<script src="{% static "javascripts/more-actions.js" %}"></script>
	<script src="{% static "javascripts/modal.js" %}"></script>
	<script src="{% static "javascripts/case.js" %}"></script>
{% endblock %}
