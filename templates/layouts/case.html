{% extends 'layouts/base.html' %}

{% load svg static %}

{% block back_link %}{% endblock %}

{% block body_classes %}app-template__body{% endblock %}

{% block title %}
	{{ case.reference_code }} - {{ case.application.organisation.name }}
{% endblock %}

{% block header %}
	<div class="app-case-header__container">
		<div class="app-case-header__aurora" style="background: {{ case.all_flags|aurora }}"></div>
		<div class="app-case-header">
			<div class="app-case-header__stuff">
				<div class="app-case-header__content">
					<ol class="app-case-header__breadcrumbs-list">
						<li class="app-case-header__breadcrumbs-list-item">
							<a class="app-case-header__breadcrumbs-link" href="{% url 'queues:cases' queue.id %}">{{ queue.name }}</a>
						</li>
					</ol>
					<h1 class="app-case-header__heading" style="z-index: 10;">
						{{ case.reference_code }} <a class="app-case-header__link govuk-!-margin-left-2" style="opacity: 0.7;" href="{% url 'organisations:organisation' case.application.organisation.id %}">{{ case.application.organisation.name }}</a>
					</h1>
				</div>
				<div class="app-case-header__controls">
					<div class="app-case-header__candy-bar">
						<span id="candy-goods" class="app-case-header__candy" data-tooltip="19 goods">
							{% svg 'goods' %}
							19
						</span>
						<div id="popup-goods" class="">
							<table class="govuk-table govuk-!-margin-0" style="min-width: 300px;">
								<p class="govuk-heading-m" style="margin-top: 10px; margin-bottom: 20px;">19 goods</p>
								<thead class="govuk-table__head">
									<tr class="govuk-table__row">
										<td class="govuk-table__header">Name</td>
										<td class="govuk-table__header">CLC</td>
									</tr>
								</thead>
								<tbody class="govuk-table__body">
									<tr class="govuk-table__row">
										<td class="govuk-table__header">Good #1</td>
										<td class="govuk-table__cell">ML1a</td>
									</tr>
									<tr class="govuk-table__row">
										<td class="govuk-table__header">Good #2</td>
										<td class="govuk-table__cell">ML1a</td>
									</tr>
									<tr class="govuk-table__row">
										<td class="govuk-table__header">Good #3</td>
										<td class="govuk-table__cell">ML1a</td>
									</tr>
									<tr class="govuk-table__row">
										<td class="govuk-table__header">Good #4</td>
										<td class="govuk-table__cell">ML1a</td>
									</tr>
									<tr class="govuk-table__row">
										<td class="govuk-table__header">Good #5</td>
										<td class="govuk-table__cell">ML1a</td>
									</tr>
								</tbody>
							</table>
						</div>
						<span id="candy-countries" class="app-case-header__candy" data-tooltip="12 countries">
							{% svg 'globe' %}
							12
						</span>
						<div id="popup-countries">
							<table class="govuk-table govuk-!-margin-0" style="min-width: 300px;">
								<thead class="govuk-table__head">
									<tr class="govuk-table__row">
										<p class="govuk-heading-m" style="margin-top: 10px; margin-bottom: 20px;">12 countries</p>
										<td class="govuk-table__header">Name</td>
										<td class="govuk-table__header">Code</td>
									</tr>
								</thead>
								<tbody class="govuk-table__body">
									<tr class="govuk-table__row">
										<td class="govuk-table__header">Poland</td>
										<td class="govuk-table__cell">PL</td>
									</tr>
									<tr class="govuk-table__row">
										<td class="govuk-table__header">Poland</td>
										<td class="govuk-table__cell">PL</td>
									</tr>
									<tr class="govuk-table__row">
										<td class="govuk-table__header">Poland</td>
										<td class="govuk-table__cell">PL</td>
									</tr>
									<tr class="govuk-table__row">
										<td class="govuk-table__header">Poland</td>
										<td class="govuk-table__cell">PL</td>
									</tr>
									<tr class="govuk-table__row">
										<td class="govuk-table__header">Poland</td>
										<td class="govuk-table__cell">PL</td>
									</tr>
								</tbody>
							</table>
						</div>
						<span id="candy-flags" class="app-case-header__candy" data-tooltip="7 flags">
							{% svg 'menu/flags' %}
							7
						</span>
						<div id="popup-flags" class="">
							<div style="min-width: 300px; padding: 0 10px; margin-bottom: -20px;">
								<p class="govuk-heading-m" style="margin-top: 10px; margin-bottom: 20px;">7 flags</p>
								{% include 'includes/flags.html' with flags=case.all_flags list=True %}
								<br>
							</div>
						</div>
					</div>

					<div class="app-case-header__candy-bar">
						<span id="candy-case-officer" class="app-case-header__candy" data-tooltip="Case officer and assigned users">
							{% svg 'user' %}
							Jessica Maxwell
						</span>
						<div id="popup-case-officer" class="">
							<div style="min-width: 300px; padding: 0 10px;">
								<p class="govuk-heading-m" style="margin-top: 10px; margin-bottom: 20px;">Case officer</p>
								<p>Jessica Maxwell</p>
								<br>
								<p class="govuk-heading-m" style="margin-top: 10px; margin-bottom: 20px;">Assigned users</p>
								<p>Anthony Lord</p>
							</div>
						</div>
						<span class="app-case-header__candy" data-tooltip="SLA">
							{% svg 'user' %}
							5 days left
						</span>
						<span class="app-case-header__candy" data-tooltip="Status">
							Submitted
						</span>
					</div>
				</div>
			</div>
			<div id="case-flags">
				<div style="margin-top: 20px; margin-bottom: -30px;">
					{% include 'includes/flags.html' with flags=case.all_flags|slice:6 %}
				</div>
			</div>
		</div>
	</div>
{% endblock %}

{% block body %}
	<!-- <div style="height: 200px; width: 200px; background: {{ case.all_flags|aurora }}"></div> -->

	<!-- <br> -->

	<!-- <p>{{ case.all_flags|aurora }}</p> -->

	<!-- {% include 'includes/flags.html' with flags=case.all_flags %} -->

	<!-- <a class="govuk-link govuk-link--no-visited-state" href="{% url 'cases:assign_flags' queue.id case.id %}?level=cases&items={{ case.id }}" id="application-edit-case-flags">Change case flags</a> -->

	{% block details %}{% endblock %}
	{% block two_thirds %}{% endblock %}
{% endblock %}

{% block javascript %}
	<script type="text/javascript">
		const goods = document.getElementById('popup-goods');
		goods.style.display = 'block';
		tippy("#candy-goods", {
			content: goods,
		 	allowHTML: true,
			interactive: true,
			animation: 'scale-subtle',
      		trigger: 'click',
			theme: 'light',
			placement: 'bottom'
		});

		const countries = document.getElementById('popup-countries');
		countries.style.display = 'block';
		tippy("#candy-countries", {
			content: countries,
			allowHTML: true,
			interactive: true,
			animation: 'scale-subtle',
			trigger: 'click',
			theme: 'light',
			placement: 'bottom'
		});

		const flags = document.getElementById('popup-flags');
		flags.style.display = 'block';
		tippy("#candy-flags", {
			content: flags,
			allowHTML: true,
			interactive: true,
			animation: 'scale-subtle',
			trigger: 'click',
			theme: 'light',
			placement: 'bottom'
		});

		const users = document.getElementById('popup-case-officer');
		users.style.display = 'block';
		tippy("#candy-case-officer", {
			content: users,
			allowHTML: true,
			interactive: true,
			animation: 'scale-subtle',
			trigger: 'click',
			theme: 'light',
			placement: 'bottom'
		});

		window.addEventListener('scroll', function (e) {
			var scrollPosition = window.scrollY;

			if (scrollPosition > 80) {
				$("#tab-bar").addClass("app-case-tab-bar--float");
			} else {
				$("#tab-bar").removeClass("app-case-tab-bar--float");
			}

			var padding = Math.max(15, 30 - (scrollPosition / 3));
			var paddingFlags = Math.min(56, scrollPosition);
			$(".app-case-header").css({"padding-top": padding, "padding-bottom": padding});
			$(".app-case-header__breadcrumbs-list").css({"opacity": 1 - (scrollPosition / 10), "transform": "translateY(" + -(30 - padding) + "px)", "margin-top": -(30 - padding) + "px", "margin-bottom": -(15 - padding) + "px"});
			$("#case-flags").css({"opacity": 1 - (scrollPosition / 10), "transform": "translateY(" + -(30 - padding) + "px)", "margin-top": -paddingFlags + "px"});
		});
	</script>
	<script src="{% static "javascripts/select-buttons.js" %}"></script>
	<script src="{% static "javascripts/modal.js" %}"></script>
	<script src="{% static "javascripts/case.js" %}"></script>
{% endblock %}
